# 测试与打包指南

## 前置准备

### 1. 安装Python（如果没有）
- 下载并安装 Python 3.7 或更高版本
- 确保将Python添加到系统PATH

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

如果遇到权限问题，使用：
```bash
pip install --user -r requirements.txt
```

## 测试步骤

### 1. 运行程序进行基本测试

```bash
python main.py
```

### 2. 功能测试清单

#### 界面测试
- [ ] 窗口正常打开
- [ ] 拖放区域显示正常
- [ ] 播放计划列表显示正常
- [ ] 系统时间显示正确
- [ ] 版权信息显示在底部

#### 文件功能测试
- [ ] 拖放音频文件到窗口（或使用"选择音频文件"按钮）
- [ ] 文件列表正确显示
- [ ] 移除选中文件功能正常
- [ ] 清空列表功能正常

#### 播放计划测试
- [ ] 选择周几（可以多选）
- [ ] 设置播放时间（小时和分钟）
- [ ] 输入计划名称
- [ ] 添加播放计划成功
- [ ] 播放计划列表显示新添加的计划
- [ ] 测试播放功能正常
- [ ] 双击编辑功能正常（或点击编辑按钮）
- [ ] 删除计划功能正常

#### 播放功能测试
- [ ] 测试播放能正常播放音频
- [ ] 播放时状态栏更新
- [ ] 播放时托盘图标闪烁（如果支持）
- [ ] Windows通知弹出（如果支持）

#### 定时播放测试
- [ ] 设置一个接近当前时间的播放计划（例如：当前时间15:30，设置15:31）
- [ ] 等待到设定时间，检查是否自动播放
- [ ] 多个计划同时触发时，是否正确排队

#### 数据持久化测试
- [ ] 添加播放计划后关闭程序
- [ ] 重新打开程序，检查播放计划是否保留
- [ ] 检查 `data/schedule.json` 文件是否正确生成

#### 系统托盘测试
- [ ] 点击窗口关闭按钮，程序最小化到托盘
- [ ] 右键托盘图标，可以显示窗口
- [ ] 右键托盘图标，可以退出程序

## 打包步骤

### 方法1：使用build.spec（推荐）

1. **确保所有依赖已安装**
   ```bash
   pip install -r requirements.txt
   pip install pyinstaller
   ```

2. **执行打包命令**
   ```bash
   pyinstaller build.spec
   ```

3. **检查输出**
   - 打包后的exe位于 `dist/RadioPotato.exe`
   - 如果打包成功，文件大小约15-25MB

### 方法2：直接使用PyInstaller命令

```bash
pyinstaller --onefile --windowed --name=RadioPotato --hiddenimport=pystray._win32 --hiddenimport=win32timezone --hiddenimport=tkinterdnd2 --hiddenimport=PIL._tkinter_finder --hiddenimport=win10toast main.py
```

### 打包后测试

1. **关闭开发环境中的程序**

2. **运行打包后的exe**
   - 双击 `dist/RadioPotato.exe`
   - 如果首次运行较慢（解压过程），属正常现象

3. **功能测试**
   - 按照"功能测试清单"再次测试所有功能
   - 特别注意：
     - 文件路径是否正确保存
     - 播放功能是否正常
     - 系统托盘是否正常

4. **便携性测试**
   - 将 `RadioPotato.exe` 复制到其他目录
   - 运行测试是否正常
   - 检查 `data` 文件夹是否正确创建

## 常见问题

### 打包错误

**问题：找不到模块**
- 解决：确保所有依赖都已安装
- 检查 `requirements.txt` 中的所有包

**问题：exe文件太大**
- 解决：在build.spec中已经排除了一些大型库
- 如果需要进一步减小，可以添加更多excludes

**问题：打包后无法运行**
- 解决：检查是否使用了正确的Python版本
- 尝试使用 `--debug=all` 查看详细错误信息

### 运行时错误

**问题：拖放功能不可用**
- 解决：这是正常的，如果tkinterdnd2未安装会使用文件选择对话框

**问题：系统托盘不显示**
- 解决：某些Windows版本可能需要额外权限，保持窗口打开即可

**问题：音频无法播放**
- 解决：检查文件格式和路径是否正确
- 确认系统音量未静音

## 发布准备

1. **测试完整流程**
   - 从添加文件到定时播放的完整流程测试
   - 在不同Windows版本上测试（如果可能）

2. **准备发布文件**
   - `RadioPotato.exe` - 主程序
   - `README.md` - 项目说明
   - `USAGE.md` - 使用说明（可选）

3. **创建发布说明**
   - 版本号
   - 功能列表
   - 已知问题

